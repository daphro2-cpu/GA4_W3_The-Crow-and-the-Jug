<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The Crow and the Jug â€“ Online Practice</title>

<style>
  body{
    font-family:"Century Gothic", Arial, sans-serif;
    background:#f6f7fb;
    margin:0;
    padding:20px;
  }
  .container{max-width:1000px;margin:auto;}
  .header{
    display:flex;align-items:center;gap:16px;
    background:#ffffff;padding:14px 16px;
    border-radius:10px;
    box-shadow:0 2px 10px rgba(0,0,0,.08);
    margin-bottom:20px;
  }
  .header img{height:60px;}
  h1{margin:0;color:#5a3fa3;}
  .sub{font-size:14px;color:#444;}

  .box{
    background:#ffffff;
    padding:16px;
    margin-bottom:20px;
    border-radius:10px;
    box-shadow:0 2px 10px rgba(0,0,0,.08);
  }
  h2{color:#5a3fa3;margin-top:0;}
  .note{
    background:#f0edff;
    padding:10px;
    border-radius:8px;
    font-size:14px;
    border:1px solid rgba(90,63,163,.25);
    line-height:1.4;
  }

  .tiles{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;}
  .tile{
    background:#5a3fa3;
    color:#fff;
    padding:6px 10px;
    border-radius:6px;
    cursor:pointer;
    font-weight:700;
    user-select:none;
  }
  .tile.used{opacity:.35;}
  .tile.locked{opacity:.25; cursor:not-allowed;}

  .answerBox{
    margin-top:6px;
    min-height:32px;
    padding:6px 10px;
    border:2px dashed #bbb;
    border-radius:8px;
    font-weight:700;
    background:#fff;
  }

  .rowBtns{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
    margin-top:8px;
  }
  .timerPill{
    font-weight:800;
    color:#333;
    background:#fff7ed;
    border:1px solid rgba(245,158,11,.35);
    padding:4px 10px;
    border-radius:999px;
    font-size:12.5px;
  }

  .feedback{margin-left:8px;font-weight:800;}
  .good{color:#138a36;}
  .bad{color:#b00020;}
  .warn{color:#b45309;}

  button{
    padding:8px 14px;
    border:none;
    border-radius:8px;
    background:#5a3fa3;
    color:#fff;
    cursor:pointer;
    font-weight:700;
  }
  button.secondary{background:#333;}
  button.ghost{
    background:transparent;
    color:#5a3fa3;
    border:2px solid #5a3fa3;
  }
  button.small{
    font-size:12px;
    padding:4px 10px;
  }
  button:disabled{opacity:.55; cursor:not-allowed;}

  select{padding:6px;border-radius:6px;min-width:180px;}

  hr{border:none;border-top:1px solid #eee;margin:14px 0;}

  .qblock{
    background:#fafafe;
    border:1px solid #ececf5;
    padding:10px;
    border-radius:10px;
    margin-bottom:12px;
  }
  .tiny{font-size:13px;color:#555;margin-top:6px;}
  .scoreline{font-weight:700;margin-top:8px;}

  .footer{
    text-align:center;
    font-size:12px;
    color:#666;
    margin-top:20px;
  }
</style>
</head>

<body>
<div class="container">

  <div class="header">
    <img src="logo.png" alt="School Logo">
    <div>
      <h1>The Crow and the Jug</h1>
      <div class="sub">GA4 â€¢ Online Reading & Vocabulary Practice</div>
    </div>
  </div>

  <div class="box">
    <div class="note">
      <b>How to play:</b><br>
      â€¢ Part 1: Read the definition. Click letters to build the word. You have <b>20 seconds</b> per word.<br>
      â€¢ <b>The timer starts only when you click the first letter for THAT word.</b><br>
      â€¢ If you get it wrong, you will see the <b>correct answer</b>.<br>
      â€¢ You can reset each word to try again.
    </div>
  </div>

  <div class="box">
    <h2>Part 1: Spelling Practice (Click to Unscramble)</h2>
    <p>All words are from todayâ€™s vocabulary list.</p>

    <ol id="spellingList"></ol>

    <button onclick="checkSpelling()">Check Part 1 âœ…</button>
    <button class="secondary" onclick="resetSpelling()">Reset Part 1 ðŸ”„</button>

    <div class="scoreline">Score: <span id="spellScore">0/10</span></div>
  </div>

  <div class="box">
    <h2>Part 2: Vocabulary in Context</h2>
    <p>Choose the best word to complete each sentence.</p>

    <ol id="contextList"></ol>

    <button onclick="checkContext()">Check Part 2 âœ…</button>
    <button class="secondary" onclick="resetContext()">Reset Part 2 ðŸ”„</button>
    <div class="scoreline">Score: <span id="ctxScore">0/10</span></div>
  </div>

  <div class="box">
    <h2>Part 3: Reading Comprehension</h2>
    <p>Choose the best answer. If you miss, read the tip and try again.</p>

    <div class="qblock">
      <strong>1) Where did the crow land when he got very tired?</strong><br>
      <label><input type="radio" name="q1" value="a"> In a desert.</label><br>
      <label><input type="radio" name="q1" value="b"> In a forest.</label>
      <div id="qf1" class="feedback"></div>
      <div id="qh1" class="tiny"></div>
    </div>

    <div class="qblock">
      <strong>2) Why couldnâ€™t the crow drink the water right away?</strong><br>
      <label><input type="radio" name="q2" value="a"> The jug was too narrow.</label><br>
      <label><input type="radio" name="q2" value="b"> The crow forgot where it was.</label>
      <div id="qf2" class="feedback"></div>
      <div id="qh2" class="tiny"></div>
    </div>

    <div class="qblock">
      <strong>3) What did the crow drop into the jug?</strong><br>
      <label><input type="radio" name="q3" value="a"> Leaves.</label><br>
      <label><input type="radio" name="q3" value="b"> Small stones.</label>
      <div id="qf3" class="feedback"></div>
      <div id="qh3" class="tiny"></div>
    </div>

    <div class="qblock">
      <strong>4) What happened to the water level after the crow dropped stones in?</strong><br>
      <label><input type="radio" name="q4" value="a"> It rose higher.</label><br>
      <label><input type="radio" name="q4" value="b"> It disappeared.</label>
      <div id="qf4" class="feedback"></div>
      <div id="qh4" class="tiny"></div>
    </div>

    <div class="qblock">
      <strong>5) What lesson does the story teach?</strong><br>
      <label><input type="radio" name="q5" value="a"> If you think carefully, you can solve problems.</label><br>
      <label><input type="radio" name="q5" value="b"> Give up quickly when something is hard.</label>
      <div id="qf5" class="feedback"></div>
      <div id="qh5" class="tiny"></div>
    </div>

    <button onclick="checkComprehension()">Check Part 3 âœ…</button>
    <button class="secondary" onclick="resetComprehension()">Reset Part 3 ðŸ”„</button>

    <div class="scoreline">Score: <span id="compScore">0/5</span></div>
  </div>

  <div class="footer">
    Great work. Practice makes you a stronger reader.
  </div>

</div>

<script>
/* =========================================================
   UTILITIES
   ========================================================= */
const SPACE_TILE = "â ";

function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}
function normalize(s){
  return s.replace(/\s+/g," ").trim().toLowerCase();
}
function lettersFromWord(word){
  const letters = [];
  for(const ch of word.toLowerCase()){
    if(ch === " ") letters.push(SPACE_TILE);
    else letters.push(ch);
  }
  return shuffle(letters);
}

/* =========================================================
   PART 1: UNSCRAMBLE (timer starts on first click per row)
   ========================================================= */
const TIME_PER_WORD = 20;

const spellingWords = [
  { word:"journey", meaning:"a long trip (noun)" },
  { word:"desert", meaning:"a hot, dry place with sand (noun)" },
  { word:"exhausted", meaning:"very tired (adjective)" },
  { word:"dazzling", meaning:"very bright (adjective)" },
  { word:"refreshed", meaning:"feeling better after rest or a drink (adjective)" },
  { word:"drop", meaning:"to let something fall (verb)" },
  { word:"soar", meaning:"to fly high in the sky (verb)" },
  { word:"come up with", meaning:"to think of an idea (phrase)" },
  { word:"locate", meaning:"to find (verb)" },
  { word:"narrow", meaning:"not wide (adjective)" }
].map(item => ({ ...item, letters: lettersFromWord(item.word) }));

const spellingList = document.getElementById("spellingList");

/* State per word */
const rowState = spellingWords.map(() => ({
  timeLeft: TIME_PER_WORD,
  intervalId: null,
  locked: false,
  started: false
}));

/* SAFETY: clear any leftover intervals (helps with â€œold codeâ€ behavior) */
function clearAllRowTimers(){
  rowState.forEach((st) => {
    if(st.intervalId){
      clearInterval(st.intervalId);
      st.intervalId = null;
    }
  });
}

function setTimerText(i){
  const el = document.getElementById("timer"+i);
  if(!el) return;
  if(!rowState[i].started){
    el.textContent = `Timer: ${TIME_PER_WORD}s (starts on first click)`;
  }else{
    el.textContent = `Timer: ${Math.max(rowState[i].timeLeft,0)}s`;
  }
}

function lockRow(i){
  rowState[i].locked = true;
  document.querySelectorAll(`#tiles${i} .tile`).forEach(t=>{
    t.classList.add("locked");
    t.onclick = null;
  });
}

function unlockRow(i){
  rowState[i].locked = false;
  document.querySelectorAll(`#tiles${i} .tile`).forEach((t)=>{
    t.classList.remove("locked");
    t.onclick = () => toggleLetter(t, i);
  });
}

function startRowTimer(i){
  if(rowState[i].intervalId) clearInterval(rowState[i].intervalId);

  rowState[i].started = true;
  rowState[i].timeLeft = TIME_PER_WORD;
  setTimerText(i);

  rowState[i].intervalId = setInterval(()=>{
    rowState[i].timeLeft--;
    setTimerText(i);

    if(rowState[i].timeLeft <= 0){
      clearInterval(rowState[i].intervalId);
      rowState[i].intervalId = null;
      lockRow(i);

      const fb = document.getElementById("fb"+i);
      fb.textContent = "Timeâ€™s up";
      fb.className = "feedback warn";
    }
  }, 1000);
}

function renderSpelling(){
  clearAllRowTimers();
  spellingList.innerHTML = "";

  spellingWords.forEach((item,i)=>{
    // reset state
    rowState[i].timeLeft = TIME_PER_WORD;
    rowState[i].locked = false;
    rowState[i].started = false;
    rowState[i].intervalId = null;

    const li = document.createElement("li");
    li.innerHTML = `
      <div><strong>${item.meaning}</strong></div>

      <div class="tiles" id="tiles${i}"></div>
      <div class="answerBox" id="ans${i}"></div>

      <div class="rowBtns">
        <span class="timerPill" id="timer${i}"></span>
        <button class="ghost small" onclick="resetOne(${i})">Reset this word</button>
        <span id="fb${i}" class="feedback"></span>
      </div>
    `;
    spellingList.appendChild(li);

    const tiles = document.getElementById("tiles"+i);
    item.letters.forEach(l=>{
      const span = document.createElement("span");
      span.className = "tile";
      span.textContent = (l===SPACE_TILE) ? "â " : l;
      span.dataset.letter = l;
      span.onclick = () => toggleLetter(span,i);
      tiles.appendChild(span);
    });

    setTimerText(i);
    unlockRow(i);
  });
}

function toggleLetter(tile,i){
  if(rowState[i].locked) return;

  // Start timer ONLY when student first clicks a letter for THIS word
  if(!rowState[i].started){
    startRowTimer(i);
  }

  const box = document.getElementById("ans"+i);
  const letter = tile.dataset.letter;

  if(tile.classList.contains("used")){
    tile.classList.remove("used");
    const current = box.textContent;
    const targetChar = (letter===SPACE_TILE) ? " " : letter;
    const idx = current.indexOf(targetChar);
    if(idx !== -1){
      box.textContent = current.slice(0, idx) + current.slice(idx+1);
    }
  }else{
    tile.classList.add("used");
    box.textContent += (letter===SPACE_TILE) ? " " : letter;
  }
}

function checkSpelling(){
  let score = 0;

  spellingWords.forEach((item,i)=>{
    const ans = normalize(document.getElementById("ans"+i).textContent);
    const correct = normalize(item.word);
    const fb = document.getElementById("fb"+i);

    if(ans === correct){
      fb.textContent = "âœ”";
      fb.className = "feedback good";
      score++;
    }else{
      // Show the correct answer if wrong
      fb.textContent = `âœ–  Correct: ${item.word}`;
      fb.className = "feedback bad";
    }
  });

  document.getElementById("spellScore").textContent = score + "/10";
}

function resetOne(i){
  if(rowState[i].intervalId){
    clearInterval(rowState[i].intervalId);
    rowState[i].intervalId = null;
  }
  rowState[i].timeLeft = TIME_PER_WORD;
  rowState[i].locked = false;
  rowState[i].started = false;

  document.getElementById("ans"+i).textContent = "";
  const fb = document.getElementById("fb"+i);
  fb.textContent = "";
  fb.className = "feedback";

  document.querySelectorAll(`#tiles${i} .tile`).forEach(t=>t.classList.remove("used"));

  setTimerText(i);
  unlockRow(i);
}

function resetSpelling(){
  spellingWords.forEach((_,i)=>resetOne(i));
  document.getElementById("spellScore").textContent = "0/10";
}

/* =========================================================
   PART 2: CONTEXT
   ========================================================= */
const ctxWords = [
  "journey","desert","exhausted","dazzling","refreshed",
  "drop","soar","come up with","locate","narrow"
];

const contextItems = [
  { ans:"journey", sentence:"The crow flew for days. It was a long ______." },
  { ans:"desert", sentence:"There were no trees or water. It was a ______." },
  { ans:"exhausted", sentence:"He could hardly move. He was ______." },
  { ans:"dazzling", sentence:"The sun was so bright it hurt his eyes â€” it was ______." },
  { ans:"refreshed", sentence:"After drinking the water, he felt ______." },
  { ans:"drop", sentence:"He had to ______ stones into the jug one by one." },
  { ans:"soar", sentence:"When he had energy again, he could ______ into the sky." },
  { ans:"come up with", sentence:"He stopped and thought, then he ______ an idea." },
  { ans:"locate", sentence:"He tried to ______ water, but he couldnâ€™t find any." },
  { ans:"narrow", sentence:"The opening was too ______, so his beak couldnâ€™t reach." }
];

const contextList = document.getElementById("contextList");

function renderContext(){
  contextList.innerHTML = "";
  contextItems.forEach((it, idx)=>{
    const li = document.createElement("li");
    const selId = `c${idx+1}`;
    const fbId = `cf${idx+1}`;

    const pool = ctxWords.filter(w => w !== it.ans);
    const distractors = shuffle(pool).slice(0,3);
    const options = shuffle([it.ans, ...distractors]);

    li.innerHTML = `
      ${it.sentence.replace("______","<b>______</b>")}
      <div style="margin-top:8px;">
        <select id="${selId}">
          <option value=""></option>
          ${options.map(o => `<option value="${o}">${o}</option>`).join("")}
        </select>
        <span id="${fbId}" class="feedback"></span>
      </div>
    `;
    contextList.appendChild(li);
  });
}

function checkContext(){
  let score = 0;
  contextItems.forEach((it, i)=>{
    const fb = document.getElementById("cf"+(i+1));
    const val = document.getElementById("c"+(i+1)).value;
    if(val === it.ans){
      fb.textContent = "âœ”";
      fb.className = "feedback good";
      score++;
    }else{
      fb.textContent = "âœ–";
      fb.className = "feedback bad";
    }
  });
  document.getElementById("ctxScore").textContent = score + "/10";
}

function resetContext(){
  contextItems.forEach((_,i)=>{
    document.getElementById("c"+(i+1)).value = "";
    const fb = document.getElementById("cf"+(i+1));
    fb.textContent = "";
    fb.className = "feedback";
  });
  document.getElementById("ctxScore").textContent = "0/10";
}

/* =========================================================
   PART 3: COMPREHENSION
   ========================================================= */
const compAnswers = {
  q1:{ correct:"a", help:"Tip: At the start, the crow lands in a place with sand and no water." },
  q2:{ correct:"a", help:"Tip: The water is at the bottom and the opening is too narrow." },
  q3:{ correct:"b", help:"Tip: He uses small stones to raise the water level." },
  q4:{ correct:"a", help:"Tip: As stones fill the jug, the water rises." },
  q5:{ correct:"a", help:"Tip: The crow solves the problem by thinking and trying a smart plan." }
};

function getRadioValue(name){
  const r = document.getElementsByName(name);
  for(const i of r){ if(i.checked) return i.value; }
  return "";
}

function checkComprehension(){
  let score = 0;
  Object.keys(compAnswers).forEach((q, i)=>{
    const chosen = getRadioValue(q);
    const fb = document.getElementById("qf"+(i+1));
    const hint = document.getElementById("qh"+(i+1));

    if(chosen === compAnswers[q].correct){
      fb.textContent = "âœ”";
      fb.className = "feedback good";
      hint.textContent = "";
      score++;
    }else{
      fb.textContent = "âœ–";
      fb.className = "feedback bad";
      hint.textContent = compAnswers[q].help;
    }
  });
  document.getElementById("compScore").textContent = score + "/5";
}

function resetComprehension(){
  Object.keys(compAnswers).forEach((q, i)=>{
    document.getElementsByName(q).forEach(r => r.checked = false);
    const fb = document.getElementById("qf"+(i+1));
    const hint = document.getElementById("qh"+(i+1));
    fb.textContent = "";
    fb.className = "feedback";
    hint.textContent = "";
  });
  document.getElementById("compScore").textContent = "0/5";
}

/* =========================================================
   INIT
   ========================================================= */
renderSpelling();
renderContext();
</script>

</body>
</html>

